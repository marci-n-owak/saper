<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="icon" href="images/mine.png">
        <title>Saper</title>
    </head>
    <body oncontextmenu="return false">
        <script>
            //Sprawdzanie przycisku
            function buttonCheck(event, x, y){
                if(event.button == 2){
                    //alert("You pressed button: prawy");
                    let flag = document.getElementById("cell" + x + y);
                    if(flag.getAttribute("style") == "background-image: url(images/flag.png); background-repeat: no-repeat; background-size: cover;"){
                        flag.setAttribute("style", "background-image: url(images/hidden.png); background-repeat: no-repeat; background-size: cover;");
                    }
                    else{
                        flag.setAttribute("style", "background-image: url(images/flag.png); background-repeat: no-repeat; background-size: cover;");
                    }
                }
            }
            //Tworzenie tabeli w Arrayce
            const iloscKwadratow = 10;
            const table = new Array(iloscKwadratow); 
                
            for (let i = 0; i < table.length; i++){ 
                table[i] = new Array(iloscKwadratow); 
            } 
            for (let i = 0; i < iloscKwadratow; i++){ 
                for (let j = 0; j < iloscKwadratow; j++){ 
                    table[i][j] = 0; 
                } 
            } 
            //Tworzenie widzialnej tabeli
            function createTable(){
                for(let i = 0; i < iloscKwadratow; i++){
                    let tableCellAbove = document.createElement("div");
                    tableCellAbove.setAttribute("class", "divTableRow");

                    let help = document.getElementById("div");
                    let tableRow = document.body.insertBefore(tableCellAbove, help);
                    tableRow.setAttribute("id", ("tableRowNumber" + i));

                    for(let j = 0; j < iloscKwadratow; j++){
                        let cell = document.createElement("div");
                        cell.setAttribute("class", "divTableCell");
                        cell.setAttribute("id", ("cell" + i + j));
                        cell.setAttribute("style", "background-image: url(images/hidden.png); background-repeat: no-repeat; background-size: cover;");
                        cell.setAttribute("onclick", ("checkClick(" + i + ", " + j + ")"));
                        cell.setAttribute("onmousedown", ("buttonCheck(event," + i + ", " + j + ")"));

                        tableRow.appendChild(cell);
                    }

                }
                /* Divy w divTable
                let divTable = document.createElement("div");
                divTable.setAttribute("class", "divTable");
                
                for(let i = 0; i < iloscKwadratow; i++){
                    //alert("tableRow" + i);
                    let tableRow = document.getElementById("tableRowNumber"+i);
                    divTable.children(tableRow);
                }
                */
            }
            createTable();


            //Pętla na ilość generowanych bomb
            function bombs(number){
                for (let i = 0; i < number; i++) {
                    generate();
                }
            }
            bombs(10);

            //Generowanie bomb 
            function generate(){
                let x = Math.floor(Math.random() * iloscKwadratow) + 0;
                let y = Math.floor(Math.random() * iloscKwadratow) + 0;

                if(table[x][y] == -1){
                    generate();
                }
                else{
                    table[x][y] = -1;

                    let doc = document.getElementById("cell" + x + y);

                    if(doc.className == "divTableCell noBomb isBomb" || doc.className == "divTableCell noBomb" || doc.className == "divTableCell"){
                        doc.setAttribute("class", "divTableCell isBomb");
                    }
                    
                    numbers(x, y);
                }          
            }

            //Tworzenie liczb wokół bomb
            function numbers(x, y){
                //z lewej strony           
                if((y>0) && (table[x][y-1] != -1)){
                    table[x][y-1] += 1;

                    let doc = document.getElementById("cell" + x + (y-1));
                }
                //z lewej górnej strony
                if((y>0) && (x>0) && (table[x-1][y-1] != -1)){
                    table[x-1][y-1] += 1;

                    let doc = document.getElementById("cell" + (x-1) + (y-1));
                }
                //z prawej górnej strony
                if((y<(iloscKwadratow-1)) && (x>0) && (table[x-1][y+1] != -1)){
                    table[x-1][y+1] += 1;

                    let doc = document.getElementById("cell" + (x-1) + (y+1));
                }
                //z prawej strony
                if((y<(iloscKwadratow-1)) && (table[x][y+1] != -1)){
                    table[x][y+1] += 1;

                    let doc = document.getElementById("cell" + x + (y+1));
                }
                //z góry
                if((x<(iloscKwadratow-1)) && (table[x+1][y] != -1)){
                    table[x+1][y] += 1;

                    let doc = document.getElementById("cell" + (x+1) + (y));
                }
                //z dołu
                if((x>0) && (table[x-1][y] != -1)){
                    table[x-1][y] += 1;

                    let doc = document.getElementById("cell" + (x-1) + (y));
                }
                //z lewej dolnej strony
                if((y>0) && (x<(iloscKwadratow-1)) && (table[x+1][y-1] != -1)){
                    table[x+1][y-1] += 1;

                    let doc = document.getElementById("cell" + (x+1) + (y-1));
                }
                //z prawej dolnej strony
                if((y<(iloscKwadratow-1)) && (x<(iloscKwadratow-1)) && (table[x+1][y+1] != -1)){
                    table[x+1][y+1] += 1;

                    let doc = document.getElementById("cell" + (x+1) + (y+1));
                }
            }

            function removeElement(iloscKwadratow){
                for(let i = 0; i < iloscKwadratow; i++){
                    let elementToDelete = document.getElementById("id" + i);
                    elementToDelete.parentNode.removeChild(elementToDelete);
                }
            }

            let executed = false;
            //Pierwsze klikniecie #do poprawy zeby się strona nie realodowała
            function checkClick(x, y){
                if(executed == false){
                    if(table[x][y] != 0){
                        window.location.reload(true);
                    }
                    else{
                        executed = true;
                        bombCheck(x, y);
                    }
                }
                else{
                    executed = true;
                    bombCheck(x, y);
                }
                // Sprawdzanie bez reloadu do zrobienia
            }
            //Sprawdzanie czy jest bomba i konsekwencje
            function bombCheck(x, y){
                let something = document.getElementsByClassName("noBomb");

                if(document.getElementById("cell" + x + y).className == "divTableCell noBomb" || document.getElementById("cell" + x + y).className == "divTableCell"){
                    document.getElementById("cell" + x + y).setAttribute("class", "divTableCell noBomb");

                }

                if(something.length >= ((iloscKwadratow*iloscKwadratow) - iloscKwadratow)){
                    let everyBomb = document.getElementsByClassName("divTableCell isBomb");
                    for(let i = 0; i < iloscKwadratow; i++){
                        everyBomb[i].setAttribute("style", "background-image: url(images/mine.png); background-repeat: no-repeat; background-size: cover;")
                    }
                    alert("Zwycięstwo!");
                    document.getElementById("restartButton").hidden = false;
                }

                if(table[x][y] == -1){
                    document.getElementById("cell" + x + y).setAttribute("style", "background-image: url(images/mineboom.png); background-repeat: no-repeat; background-size: cover;");
                    alert("Porażka :c");
                }
                if(table[x][y] > 0){
                    let numberOfMines = table[x][y];
                    document.getElementById("cell" + x + y).setAttribute("style", "background-image: url(images/" + numberOfMines + ".png); background-repeat: no-repeat; background-size: cover;");

                }
                if(table[x][y] != -1 && document.getElementById("cell" + x + y).getAttribute("style") == "background-image: url(images/hidden.png); background-repeat: no-repeat; background-size: cover;"){
                    document.getElementById("cell" + x + y).setAttribute("style", "background-image: url(images/0.png); background-repeat: no-repeat; background-size: cover;");

                    //z lewej strony           
                    if((y>0)){
                        bombCheck((x), (y-1));
                        let doc = document.getElementById("cell" + x + (y-1));

                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                    //z lewej górnej strony
                    if((y>0) && (x>0)){
                        bombCheck((x-1), (y-1));
                        let doc = document.getElementById("cell" + (x-1) + (y-1));

                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                    //z prawej górnej strony
                    if((y<(iloscKwadratow-1)) && (x>0)){
                        bombCheck((x-1), (y+1));
                        let doc = document.getElementById("cell" + (x-1) + (y+1));

                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                    //z prawej strony
                    if((y<(iloscKwadratow-1))){
                        bombCheck((x), (y+1));
                        let doc = document.getElementById("cell" + x + (y+1));

                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                    //z góry
                    if((x<(iloscKwadratow-1))){
                        bombCheck((x+1), (y));
                        let doc = document.getElementById("cell" + (x+1) + (y));
                        
                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                    //z dołu
                    if((x>0)){
                        bombCheck((x-1), (y));
                        let doc = document.getElementById("cell" + (x-1) + (y));

                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                    //z lewej dolnej strony
                    if((y>0) && (x<(iloscKwadratow-1))){
                        bombCheck((x+1), (y-1));
                        let doc = document.getElementById("cell" + (x+1) + (y-1));

                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                    //z prawej dolnej strony
                    if((y<(iloscKwadratow-1)) && (x<(iloscKwadratow-1))){
                        bombCheck((x+1), (y+1));
                        let doc = document.getElementById("cell" + (x+1) + (y+1));

                        if(doc.className != "divTableCell isBomb" || doc.className != "divTableCell noBomb"){
                            doc.classList.add("noBomb");
                        }
                    }
                }
            }
        </script>
        <input type="button" value="Restart" id="restartButton" onclick="window.location.reload()" hidden>
    </body>
</html>